from script.population import Population
from sklearn.metrics import classification_report
from sklearn.metrics import accuracy_score
from utils.evaluator import get_score
import matplotlib.pyplot as plt
import pickle
FILEPATH = '../../dataset/ClaMP_Integrated-5184.csv'

if __name__ == '__main__':
    pop_size = 100
    mutation_rate = 0.01
    feature_num = 69
    crossover_rate = 1
    max_generations = 200
    tournament_size = 10

    pop = Population(pop_size, mutation_rate, feature_num, max_generations, crossover_rate, tournament_size, FILEPATH)
    pop.print_population_status()

    while not pop.finished:
        pop.natural_selection()
        pop.print_population_status()

    gen_arr = [i for i in range(pop.generations)]
    plt.plot(gen_arr, pop.avg_arr[1:], label="Average accuracy")
    plt.plot(gen_arr, pop.best_arr[1:], label="Best accuracy")
    plt.legend()
    plt.xlabel("Generation")
    plt.ylabel("Accuracy")
    plt.show()
    get_score(pop.best_model, pop.best_ind, pop.x_test, pop.y_test)
    with open('../results/models/p={}_m={}_c={}_g={}_score={}'.format(pop_size, mutation_rate, crossover_rate,
                                                                    max_generations, pop.best_ind_score), 'wb') as file:
        pickle.dump(pop.best_model, file)
